<html>
	<head>
		<link type="text/css" href="css/bootstrap.min.css" rel="stylesheet" />
		<link type="text/css" href="css/index.css" rel="stylesheet" />
		<script src="js/jquery-2.0.0.min.js"></script>
		<script>
		$(function(){
			var GameHandler = {
				_jqTable:$(".tic-table"),
				_table:[-1,-1,-1,-1,-1,-1,-1,-1,-1], //-1 for unused
				_currentMove:0,//0 for circle , 1 for cross
				init:function(){
					this._jqTable.on("click",".cell-unused",function(){
						GameHandler.nextMove($(this).data("index"));
					});
				},
				nextMove:function(index){
					var cell = this._jqTable.find(".cell").eq(index);
					cell.removeClass("cell-unused");
					cell.addClass("cell-actived cell-"+ (this._currentMove == 0 ?"circle" :"cross"));
					this._table[index] = this._currentMove;

					var linked = this.checkLine(this._currentMove); //ru03t86g4z.3

					if(linked != null){
						this.showResult(linked);
						return true;
					}
					if(!this.checkAvailable()){
						this.save(-1);
						this.gameEnd("No winers");
						return true;
					}

					this._currentMove = (this._currentMove + 1) %2;
				},
				checkAvailable:function(){
					for(var i = 0; i < this._table.length;++i){
						if(this._table[i] == -1){
							return true;
						}
					}
					return false;
				},
				checkLine:function(checkedType){
					var lines = [
						[0,1,2],
						[3,4,5],
						[6,7,8],
						[0,3,6],
						[1,4,7],
						[2,5,8],
						[0,4,8],
						[2,4,6]
					];
					var lined = null , linked_line = null;
					for(var i= 0;i < lines.length;++i){
						lined = true;
						for(var j = 0 ; j < lines[i].length; ++j){
							if(this._table[lines[i][j]] != checkedType){
								lined = false;
							}
						}
						if(lined){
							return lines[i];
						}
					}

					return null;
				},
				showResult:function(line){
					var parentoffset = this._jqTable.offset();
					var cells = this._jqTable.find(".cell");
					
					for(var i =0 ; i < line.length ;++i){
						cells.eq(line[i]).addClass("cell-lined");
					}

					this.save(this._currentMove);
					this.gameEnd(this._currentMove == 0 ? "Circle win!" :"Cross win!")
				},
				gameEnd:function(text){
					this._jqTable.off("click");
					this._jqTable.find(".status").text(text);
					this._jqTable.find(".controll").addClass("controll-active");
				},
				save: function(winer){
					var records = [];
					if(localStorage.records != ""){
						records = JSON.parse(localStorage.records);
					}
					records.push({table:this._table,winer:winer,time: new Date()});
					if( records.length > 5 ) records.length = 5;//only last ten items

					localStorage.records = JSON.stringify(records);
				}
			}

			GameHandler.init();
		});
		</script>
	</head>
	<body>
		<div class="game-view">
			<h1>Tic-Tac-Toe Game</h1>
			<div class="tic-table">
				<div class="column column1 clearfix">
					<div class="cell cell-unused" data-index="0">
						<div class="icon"></div>
					</div>
					<div class="cell cell-unused " data-index="1">
						<div class="icon"></div>
					</div>
					<div class="cell cell-unused " data-index="2">
						<div class="icon"></div>
					</div>
				</div>
				<div class="column column2 clearfix">
					<div class="cell cell-unused" data-index="3">
						<div class="icon"></div>
					</div>
					<div class="cell cell-unused" data-index="4">
						<div class="icon"></div>
					</div>
					<div class="cell cell-unused" data-index="5">
						<div class="icon"></div>
					</div>
				</div>
				<div class="column column3 clearfix">
					<div class="cell cell-unused "  data-index="6">
						<div class="icon"></div>
					</div>

					<div class="cell cell-unused "  data-index="7">
						<div class="icon"></div>
					</div>
					<div class="cell cell-unused "  data-index="8">
						<div class="icon"></div>
					</div>
				</div>
				<div class="status"></div>
				<div class="controll">
					<a href="game.html" class="btn" >Play Again</a>
					<a href="record.html" class="btn" >View Score</a>
				</div>
			</div>
		</div>
	</body>
</html>